nano /etc/network/interfaces

--

nmcli dev set eth0 managed no
nmcli dev set wlan0 managed no
nmcli dev set eth1 managed no

apt-get remove network-manager
ifdown eth0; ifup eth0
sudo dpkg-reconfigure resolvconf

systemctl disable hostapd

--- Installation Software ---

apt-get install iptables mosquitto-clients lighttpd isc-dhcp-server bind9 bind9utils 
systemctl enable iptables mosquitto-clients lighttpd isc-dhcp-server bind9 bind9utils 

-- Copy Config Files with WinSCP --

--- additional config ---

locale-gen de_CH.UTF-8
update-locale LANG=de_CH.UTF-8
timedatectl set-timezone Europe/Zurich
swapoff -a

hostnamectl set-hostname NanoGateway

ifup wlan0

-- DHCP Server --

systemctl enable isc-dhcp-server

nano /etc/default/isc-dhcp-server

  INTERFACES="wlan0"


/usr/sbin/rndc-confgen -a -b 512

cp /etc/bind/rndc.key /etc/dhcp/ddns-keys
chown root:root /etc/dhcp/ddns-keys/rndc.key
chmod 640 /etc/dhcp/ddns-keys/rndc.key
chmod +x /usr/bin/dhcps


-- DNS Server --

systemctl enable bind9

chmod -R 775 /etc/bind/zones
chown -R root:bind /etc/bind/zones

named-checkconf

systemctl restart isc-dhcp-server.service


--- OpenVPN ---

wget https://git.io/vpn -O openvpn-install.sh
chmod +x openvpn-install.sh
./openvpn-install.sh

IP address: 192.168.42.1
Public IP address / hostname: buesche.ddns.net

Client File von /root downloaden



-- Firewall --

iptables -t nat -D POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to-source 192.168.42.1
iptables -A INPUT -i eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A INPUT -i tun0 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
iptables -A FORWARD -j ACCEPT
iptables -A FORWARD -i eth0 -o tun0 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i tun0 -o eth0 -j ACCEPT
iptables -t nat -A PREROUTING -d 10.8.0.0/24 -i tun0 -j NETMAP --to 192.168.42.0/24
iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o wlan0 -j MASQUERADE
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

iptables -A INPUT -p tcp --destination-port 443 -j REJECT --reject-with tcp-reset
iptables -A INPUT -p udp --destination-port 80 -j REJECT --reject-with icmp-port-unreachable
iptables -A INPUT -p udp --destination-port 443 -j REJECT --reject-with icmp-port-unreachable

iptables-save > /etc/iptables/rules.v4

nano /etc/rc.local

iptables-restore < /etc/iptables/rules.v4


-- Change PSK --

chmod +x /usr/bin/pskc


-- Webserver --

www-data ALL=(ALL) NOPASSWD: ALL

-- DHCP Leases --

chmod +x /usr/bin/ldhcp.py

-- chgip --

chmod +x /usr/bin/chgip

--- CPU Temp ---

chmod +x /usr/bin/cputemp

crontab -e

*/1 * * * * /usr/bin/cputemp

--- pi-hole ---

wget -O basic-install.sh https://install.pi-hole.net
chmod +x basic-install.sh
./basic-install.sh

wlan0
address: 192.168.42.1/24
gateway: 192.168.1.1

sudo pihole -a -p

bind9 forwarders:



systemctl restart pihole-FTL.service


nano /etc/dnsmasq.conf

port=5353

nano /etc/dnsmasq.d/01-pihole.conf
server=192.168.42.1
server=127.0.0.1


--- Update ---

pihole -up

nano /etc/dnsmasq.conf

port=5353

nano /etc/dnsmasq.d/01-pihole.conf
server=192.168.42.1
server=127.0.0.1

restart